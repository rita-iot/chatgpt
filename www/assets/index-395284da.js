import{r as n,A as F,_ as f,a6 as N,q as D,s as $,F as b,y as i,j as s,b as x,B as y,a7 as C,a5 as T,m as j,M as O,a8 as U,e as M,a9 as Z,aa as A,ab as k,ac as E}from"./index-7d328e61.js";import{L as I}from"./index-47aba126.js";import{U as V}from"./index-02a465a6.js";var R={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0068.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"}}]},name:"mail",theme:"outlined"};const q=R;var B=function(o,a){return n.createElement(F,f(f({},o),{},{ref:a,icon:q}))};const H=n.forwardRef(B),J="_userPage_container_17t63_1",G="_userPage_card_17t63_12",Y="_userPage_17t63_1",K="_userPage_operate_17t63_26",Q="_userPage_signin_17t63_31",W="_userPage_signin_item_17t63_36",X="_userPage_signin_selectTtem_17t63_59",r={userPage_container:J,userPage_card:G,userPage:Y,userPage_operate:K,userPage_signin:Q,userPage_signin_item:W,userPage_signin_selectTtem:X},ee=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"];function ie(){const u=N(),{token:o,user_info:a}=D(),{user_introduce:g}=$(),[c]=b.useForm(),[v,_]=n.useState(!1),[m,w]=n.useState([]),[l,h]=n.useState({open:!1,title:"修改信息",type:""});function p(){o&&E().then(e=>{e.code||w(e.data)})}const P=n.useMemo(()=>{const e=new Date().getFullYear(),t=new Date().getMonth()+1,d=new Date(e,t,0).getDate();return Array.from({length:d},(ae,L)=>{const S=L+1;return i("yyyy-MM-dd",new Date(`${e}-${t}-${S}`))})},[]),z=n.useMemo(()=>m.map(t=>i("yyyy-MM-dd",new Date(t.create_time))),[m]);return n.useEffect(()=>{p()},[]),s.jsxs("div",{className:r.userPage,children:[s.jsx(I,{children:s.jsx("div",{className:r.userPage_container,children:s.jsxs(x,{direction:"vertical",style:{width:"100%"},children:[s.jsx(V,{info:a,children:s.jsx("div",{className:r.userPage_operate,children:s.jsx(y,{block:!0,type:"dashed",danger:!0,onClick:()=>{h({open:!0,title:"重置密码",type:"password"}),c.setFieldsValue({account:a==null?void 0:a.account})},children:"重置密码"})})}),g&&s.jsxs("div",{className:r.userPage_card,children:[s.jsx("h4",{children:"公告"}),s.jsx("div",{dangerouslySetInnerHTML:{__html:g}})]}),s.jsxs("div",{className:r.userPage_card,children:[s.jsxs("h4",{children:["签到日历（",i("yyyy年MM月",new Date(P[0])),"）"]}),s.jsxs(x,{direction:"vertical",children:[s.jsx("div",{className:r.userPage_signin,children:P.map(e=>{const t=z.includes(e)?`${r.userPage_signin_item} ${r.userPage_signin_selectTtem}`:r.userPage_signin_item;return s.jsxs("div",{className:t,children:[s.jsx("p",{children:i("dd",new Date(e))===i("dd")?"今":i("dd",new Date(e))}),s.jsx("p",{children:ee[Number(i("MM",new Date(e)))-1]})]},e)})}),s.jsx(y,{loading:v,type:"primary",block:!0,disabled:!!(a!=null&&a.is_signin),onClick:()=>{_(!0),C().then(e=>{e.code||(T.fetchUserInfo(),p(),j.success(e.message))}).finally(()=>{_(!1)})},children:a!=null&&a.is_signin?"今日已签到":"立即签到"})]})]})]})})}),s.jsxs(O,{width:500,title:l.title,open:l.open,form:c,modalProps:{destroyOnClose:!0,onCancel:()=>{h(e=>({...e,open:!1}))},okText:"提交"},onFinish:e=>U(e).then(t=>t.code?!1:(j.success("重置成功"),u("/login"),!0)).catch(()=>!1),children:[s.jsx(M,{fieldProps:{size:"large",prefix:s.jsx(H,{})},name:"account",placeholder:"邮箱",disabled:!0,rules:[{required:!0,message:"请输入电子邮箱",pattern:/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/}]}),s.jsx(Z,{fieldProps:{size:"large",prefix:s.jsx(A,{})},captchaProps:{size:"large"},placeholder:"验证码",captchaTextRender:(e,t)=>e?`${t} 获取验证码`:"获取验证码",name:"code",rules:[{required:!0,message:"请输入验证码！"}],onGetCaptcha:async()=>{const e=c.getFieldValue("account");return!e||!/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/.test(e)?(c.setFields([{name:"account",errors:["请输入有效的邮箱地址"]}]),Promise.reject()):new Promise((t,d)=>k({source:e}).then(()=>t()).catch(d))}}),l.type==="password"&&s.jsx(M.Password,{name:"password",fieldProps:{size:"large",prefix:s.jsx(A,{className:"prefixIcon"})},placeholder:"请输入密码",rules:[{required:!0,message:"8位及以上至少包含一个字母和一个数字",pattern:/^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z\d]{8,}$/}]})]})]})}export{ie as default};
